<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>draw point</title>
</head>
<body>

<canvas width="500" height="500" id="oCanvas" style="border: 1px solid #999"></canvas>


<!--
	gl_Position   必须赋值, 否则着色器无法正常工作
	gl——PointSize 默认为 1.0
-->
<script type="notjs" id="vertex">

    void main () {
      gl_Position  = vec4(0, 0, 0, 1);   // vec4:  顶点位置坐标
      gl_PointSize = 10.0;               // float: 顶点尺寸( 像素 )
    }

</script>

<script type="notjs" id="fragment">

	void main () {
		gl_FragColor = vec4(0, 0, 0, 1);     // 片元颜色( RGBA )
	}

</script>

<script type="text/javascript">
	
	/**
	 * 1. 获取 WebGL 绘图上下文
	 * 2. 初始化着色器
	 * 3. 设置点的坐标信息
	 * 4. 设置 <canvas/> 背景色
	 * 5. 清空 <canvas/>
	 * 6. 执行绘制
	 */
	
	let oCanvas = document.getElementById('oCanvas');
	const gl = oCanvas.getContext('webgl');
	console.log('-> gl', gl);
	
	// 判断当前浏览器及版本是否兼容
	if (!gl) {
		alert('浏览器不支持 WebGL');
	}
	
	/**
	 * createShader     // 创建着色器
	 *
	 * @gl:       canvasContext
	 * @type:     着色器类型
	 * @source:   添加的程序
	 */
	function createShader(gl, type, source) {
		/**
		 * 1.创建着色器
		 *
		 *    gl.createShader(type);
		 *      - @type: gl.VERTEX_SHADER
		 *               gl.FRAGMENT_SHADER
		 *
		 * 2. 向着色器中添加资源
		 *
		 *    gl.shaderSource(shader, source)
		 *      - @shader: 着色器
		 *      - @source: 添加的程序
		 *
		 * 3. 便衣着色器代码
		 *
		 *    gl.compileShader(shader)
		 *      - @shader: 要编译的着色器
		 *
		 */
		let shader = gl.createShader(type);
		gl.shaderSource(shader, source);
		gl.compileShader(shader);
		const createStatus = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
		if (createStatus) {
			return shader;
		} else {
			gl.getShaderInfoLog(shader);
		}
	}
	
	// 获取着色器配置信息
	let vertexStr = document.getElementById('vertex').innerText;
	let fragmentStr = document.getElementById('fragment').innerText;
	
	// 创建着色器
	let vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexStr);
	let fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentStr);
	
	
	/**
	 * createProgram      // 创建程序
	 *
	 * @gl:               canvasContext
	 * @vertexShader:     顶点着色器
	 * @fragmentShader:   片段着色器
	 */
	function createProgram(gl, vertexShader, fragmentShader) {
		/**
		 * 1. 创建程序
		 *
		 *    gl.createProgram();
		 *
		 * 2. 绑定着色器程序
		 *
		 *    gl.attachShader(program, shader)
		 *      - @program: 被插入的程序
		 *      - @shader: 要绑定的程序
		 *
		 * 3. 连接着色器程序
		 *
		 *    gl.linkProgram(program)
		 */
		let program = gl.createProgram();
		gl.attachShader(program, vertexShader);
		gl.attachShader(program, fragmentShader);
		gl.linkProgram(program);
		const linkStatus = gl.getProgramParameter(program, gl.LINK_STATUS);
		if (linkStatus) {
			return program;
		} else {
			gl.getShaderInfoLog(program);
		}
	}
	
	const program = createProgram(gl, vertexShader, fragmentShader);
	
	gl.useProgram(program);             // 使用程序
	gl.clearColor(0, 0, 1, 1);          // 清空颜色
	gl.clear(gl.COLOR_BUFFER_BIT);      // 清空画布
	gl.drawArrays(gl.POINTS, 0, 1);     // 执行会追


</script>

</body>
</html>
